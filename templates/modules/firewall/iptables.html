{% load static %}
{% load i18n %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE|default:'en' }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% trans "iptables Firewall Management" %} - Ophiron</title>

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Bootstrap CSS for modals -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Base styles to match dashboard -->
    <link rel="stylesheet" href="{% static 'css/main.css' %}">
    <link rel="stylesheet" href="{% static 'css/components/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard/style.css' %}">
    <!-- Page specific styles -->
    <link rel="stylesheet" href="{% static 'css/firewall/iptables.css' %}">

    <!-- Bootstrap JS for modals -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Header and Navigation Scripts -->
    <script defer src="{% static 'js/components/header.js' %}"></script>
    <!-- JavaScript Translations -->
    <script>
        window.jsTranslations = {
            'checking': '{% trans "Checking..." %}',
            'refresh': '{% trans "Refresh" %}',
            'back': '{% trans "Back" %}',
            'loading_rules': '{% trans "Loading rules..." %}',
            'no_rules_found': '{% trans "No Rules Found" %}',
            'no_iptables_rules_configured': '{% trans "No iptables rules are currently configured." %}',
            'firewall_rules': '{% trans "Firewall Rules" %}',
            'iptables_firewall': '{% trans "iptables Firewall" %}',
            'error_loading_status': '{% trans "Error loading iptables status" %}',
                   'error_loading_rules': '{% trans "Error loading iptables rules" %}',
                   'action': '{% trans "Action" %}',
                   'direction': '{% trans "Direction" %}',
                   'source': '{% trans "Source" %}',
                   'destination': '{% trans "Destination" %}',
                   'port': '{% trans "Port" %}',
                   'protocol': '{% trans "Protocol" %}',
                   'chain': '{% trans "Chain" %}',
                   'target': '{% trans "Target" %}',
                   'options': '{% trans "Options" %}',
                   'comment': '{% trans "Comment" %}',
                   'delete_rule': '{% trans "Delete Rule" %}',
                   'confirm_delete': '{% trans "Are you sure you want to delete this rule?" %}',
                   'rule_deleted_successfully': '{% trans "Rule deleted successfully" %}',
                   'error_deleting_rule': '{% trans "Error deleting rule" %}',
                   'enabled': '{% trans "Enabled" %}',
                   'disabled': '{% trans "Disabled" %}',
                   'not_available': '{% trans "Not Available" %}',
                   'loading_rules': '{% trans "Loading rules..." %}',
                   'rules': '{% trans "rules" %}',
                   'deleting_rule': '{% trans "Deleting rule" %}',
                   'connection_error': '{% trans "Connection error" %}'
        };
    </script>
    
    <!-- Page script -->
    <script defer src="{% static 'js/firewall/iptables.js' %}"></script>
</head>
<body>
    {% csrf_token %}
    <div class="dashboard-container">
        {% include 'components/header.html' %}

        <main class="dashboard-main">
            <!-- iptables Management -->
            <div class="iptables-management">
                <!-- Page Header -->
                <div class="iptables-header">
                    <div class="iptables-header-content">
                        <div class="iptables-title">
                            <h1>
                                <i class="fas fa-shield-alt"></i>
                                {% trans "iptables Firewall" %}
                            </h1>
                            <div class="iptables-status" id="iptablesStatusIndicator">
                                <div class="status-dot"></div>
                                <span class="status-text">{% trans "Checking..." %}</span>
                            </div>
                        </div>
                        <div class="iptables-actions">
                            <button id="refreshIptables" class="btn-secondary">
                                <i class="fas fa-sync-alt"></i>
                                {% trans "Refresh" %}
                            </button>
                            <a href="{% url 'firewall:selection' %}" class="btn-secondary">
                                <i class="fas fa-arrow-left"></i>
                                {% trans "Back" %}
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Rules Section -->
                <div class="iptables-rules-section">
                    <div class="iptables-rules-header">
                        <h3>
                            <i class="fas fa-list"></i>
                            {% trans "Firewall Rules" %}
                            <span class="rules-count" id="rulesCount">(0)</span>
                        </h3>
                    </div>
                    
                    <!-- Loading State -->
                    <div class="rules-loading" id="iptablesRulesLoading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>{% trans "Loading rules..." %}</span>
                    </div>

                    <!-- Rules by Chain -->
                    <div id="iptablesRulesContainer" style="display: none;">
                        <!-- Rules will be organized by chain here -->
                    </div>

                    <!-- Empty State -->
                    <div class="rules-empty" id="iptablesRulesEmpty" style="display: none;">
                        <i class="fas fa-shield-alt"></i>
                        <h3>{% trans "No Rules Found" %}</h3>
                        <p>{% trans "No iptables rules are currently configured." %}</p>
                    </div>
                </div>
            </div>
        </main>
    </div>
    
    <!-- iptables Delete Modal -->
    {% include 'modules/firewall/iptables_delete_modal.html' %}
</body>
</html>
